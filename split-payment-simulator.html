<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Impacto da Reforma Tributária no Fluxo de Caixa</title>
    
     <!-- Bibliotecas externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Arquivos CSS próprios -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/tabs.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/charts.css">
    <link rel="stylesheet" href="css/modals.css">
	<link rel="stylesheet" href="css/importacao.css">
</head>
<body>
	<div id="cache-alert" class="cache-alert-overlay">
		<div class="cache-alert-box">
			<div class="cache-alert-header">
				<h3>⚠️ Atenção: Limpe o Cache do Navegador</h3>
				<span id="close-cache-alert" class="close-alert">&times;</span>
			</div>
			<div class="cache-alert-content">
				<p>Para garantir o funcionamento correto do simulador, recomendamos <strong>limpar o cache do seu navegador</strong> antes de iniciar.</p>

				<div class="shortcut-container">
					<div class="shortcut-item">
						<div class="shortcut-os">Windows</div>
						<div class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>F5</kbd></div>
						<div class="shortcut-alt">ou</div>
						<div class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></div>
					</div>
					<div class="shortcut-item">
						<div class="shortcut-os">Mac</div>
						<div class="shortcut-keys"><kbd>⌘ Cmd</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></div>
					</div>
					<div class="shortcut-item">
						<div class="shortcut-os">Linux/Unix</div>
						<div class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></div>
					</div>
				</div>

				<p class="cache-alert-note">Se o simulador apresentar comportamento inesperado após atualização, repita o processo de limpeza de cache. Aguarde o carregamento completo do sistema.</p>

				<button id="proceed-button" class="proceed-btn">Entendi, Prosseguir</button>
			</div>
		</div>
	</div>
	<div class="beta-banner">VERSÃO BETA - APENAS PARA TESTES</div>
    <div class="container">
        <div class="header">
            <img src="imagens/expertzy-it.png" alt="Expertzy Inteligência Tributária" class="logo">
            <h1>Simulador de Impacto do Split Payment no Fluxo de Caixa</h1>
        </div>    
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="simulacao">Simulação</button>
                <button class="tab-button" data-tab="configuracoes">Configurações</button>
                <button class="tab-button" data-tab="estrategias">Estratégias de Mitigação</button>
                <button class="tab-button" data-tab="memoria">Memória de Cálculo</button>
                <button class="tab-button" data-tab="ajuda">Ajuda e Documentação</button>
				<button class="tab-button" data-tab="importacao-sped">Importação SPED</button>
            </div>
		           
            <!-- Aba de Simulação -->
            <div id="simulacao" class="tab-content active">
			<div class="simulation-container">
				<!-- Coluna Esquerda - Formulários de Entrada -->
				<div class="simulation-inputs">
					<!-- Painel de entrada -->
					<div class="panel">
						<!-- Seção "Dados da Empresa" -->
						<div class="group-box">
							<h3>Dados da Empresa</h3>
							<div class="form-group">
								<label for="empresa">Empresa:</label>
								<input type="text" id="empresa" placeholder="Nome da empresa">						
								<label for="faturamento">Faturamento Mensal:</label>
								<input type="text" id="faturamento" value="0" class="money-input">													
								<label for="margem">Margem Operacional (%):</label>
								<input type="number" id="margem" value="15" min="0" max="100" step="0.1">
								<div class="form-group">
								<label for="tipo-empresa">Tipo de Empresa:</label>
								<select id="tipo-empresa" name="tipo-empresa">
									<option value="">Selecione o tipo...</option>
									<option value="comercio">Comércio</option>
									<option value="industria">Indústria</option>
									<option value="servicos">Serviços</option>
								</select>
								</div>												
								<label for="tipo-operacao">Tipo de Operação:</label>
								<select id="tipo-operacao" onchange="ajustarCamposOperacao()">
									<option value="">Selecione o tipo de operação...</option>
									<option value="b2b">B2B (Empresa-Empresa)</option>
									<option value="b2c">B2C (Empresa-Consumidor)</option>
									<option value="mista">Mista</option>
								</select>
							</div>
						</div>				
					
						<div class="group-box">
							<h3>Sistema Tributário Atual</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="regime">Regime Tributário:</label>
										<select id="regime" onchange="ajustarCamposTributarios()">
											<option value="">Selecione o regime tributário...</option>
											<option value="simples">Simples Nacional</option>
											<option value="presumido">Lucro Presumido</option>
											<option value="real">Lucro Real</option>
										</select>
									</div>														

								<!-- Campos específicos para Simples Nacional -->
								<div id="campos-simples" class="campos-regime" style="display: none;">
									<div class="form-row">
										<div class="form-column">
											<div class="form-group">
												<label for="aliquota-simples">Alíquota Simples Nacional (%):</label>
												<input type="number" id="aliquota-simples" name="aliquota-simples" value="6.0" min="0" max="30" step="0.01">
											</div>
										</div>
									</div>
								</div>

								<!-- Campos para Lucro Presumido e Real -->
								<div id="campos-lucro" class="campos-regime" style="display: none;">
									<!-- PIS/COFINS -->
									<div class="form-row">
										<div class="form-column">
											<div class="form-group">
												<label for="pis-cofins-regime">Regime PIS/COFINS:</label>
												<select id="pis-cofins-regime" onchange="ajustarAliquotasPisCofins()">
													<option value="cumulativo">Cumulativo</option>
													<option value="nao-cumulativo">Não-Cumulativo</option>
												</select>
											</div>
										</div>
									</div>

									<div id="campos-pis-cofins-creditos" style="display: none;">
										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="pis-aliquota">Alíquota PIS (%):</label>
													<input type="number" id="pis-aliquota" value="1.65" min="0" max="10" step="0.01" readonly>
												</div>
											</div>
											<div class="form-column">
												<div class="form-group">
													<label for="cofins-aliquota">Alíquota COFINS (%):</label>
													<input type="number" id="cofins-aliquota" value="7.6" min="0" max="20" step="0.01" readonly>
												</div>
											</div>
										</div>
									</div>

									<div class="form-row">
										<div class="form-column">
											<div class="form-group">
												<label for="pis-cofins-base-calc">Base de Cálculo (% do faturamento):</label>
												<input type="number" id="pis-cofins-base-calc" value="50" min="0" max="100" step="0.1">
												<small class="text-muted">Percentual de aquisições com direito a crédito</small>
											</div>
										</div>
										<div class="form-column">
											<div class="form-group">
												<label for="pis-cofins-perc-credito">Percentual de Aproveitamento (%):</label>
												<input type="number" id="pis-cofins-perc-credito" value="100" min="0" max="100" step="0.1">
												<small class="text-muted">Percentual efetivamente aproveitado</small>
											</div>
										</div>
									</div>

									<div class="form-row">
										<div class="form-column">
											<div class="form-group">
												<label for="creditos-pis-cofins-calc">Créditos PIS/COFINS Calculados:</label>
												<input type="text" id="creditos-pis-cofins-calc" class="money-input" readonly>
												<small class="text-muted">Calculado automaticamente</small>
											</div>
										</div>
									</div>

									<!-- ICMS para empresas comerciais/industriais -->
									<div id="campos-icms" class="campos-operacao">
										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="aliquota-icms">Alíquota ICMS (%):</label>
													<input type="number" id="aliquota-icms" value="18.0" min="0" max="30" step="0.01">
												</div>
											</div>
										</div>

										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="icms-base-calc">Base de Cálculo (% do faturamento):</label>
													<input type="number" id="icms-base-calc" value="60" min="0" max="100" step="0.1">
													<small class="text-muted">Percentual de aquisições com ICMS</small>
												</div>
											</div>
											<div class="form-column">
												<div class="form-group">
													<label for="icms-perc-credito">Percentual de Aproveitamento (%):</label>
													<input type="number" id="icms-perc-credito" value="100" min="0" max="100" step="0.1">
													<small class="text-muted">Percentual efetivamente aproveitado</small>
												</div>
											</div>
										</div>

										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="creditos-icms-calc">Créditos ICMS Calculados:</label>
													<input type="text" id="creditos-icms-calc" class="money-input" readonly>
													<small class="text-muted">Calculado automaticamente</small>
												</div>
											</div>
										</div>

										<div class="form-row">
											<div class="form-column">
												<div class="form-group checkbox-group">
													<input type="checkbox" id="possui-incentivo-icms" onchange="toggleCamposIncentivoICMS()">
													<label for="possui-incentivo-icms">Possui Incentivo Fiscal ICMS</label>
												</div>
											</div>
											<div class="form-column" id="campo-incentivo-icms" style="display: none;">
												<div class="form-group">
													<label for="incentivo-icms">Redução por Incentivo (%):</label>
													<input type="number" id="incentivo-icms" value="0" min="0" max="100" step="0.1">
												</div>
											</div>
										</div>
									</div>

									<!-- IPI para empresas industriais -->
									<div id="campos-ipi" class="campos-operacao">
										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="aliquota-ipi">Alíquota IPI (%):</label>
													<input type="number" id="aliquota-ipi" value="10.0" min="0" max="100" step="0.01">
												</div>
											</div>
										</div>

										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="ipi-base-calc">Base de Cálculo (% do faturamento):</label>
													<input type="number" id="ipi-base-calc" value="40" min="0" max="100" step="0.1">
													<small class="text-muted">Percentual de aquisições com IPI</small>
												</div>
											</div>
											<div class="form-column">
												<div class="form-group">
													<label for="ipi-perc-credito">Percentual de Aproveitamento (%):</label>
													<input type="number" id="ipi-perc-credito" value="100" min="0" max="100" step="0.1">
													<small class="text-muted">Percentual efetivamente aproveitado</small>
												</div>
											</div>
										</div>

										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="creditos-ipi-calc">Créditos IPI Calculados:</label>
													<input type="text" id="creditos-ipi-calc" class="money-input" readonly>
													<small class="text-muted">Calculado automaticamente</small>
												</div>
											</div>
										</div>
									</div>

									<!-- ISS para empresas de serviços -->
									<div id="campos-iss" class="campos-operacao" style="display: none;">
										<div class="form-row">
											<div class="form-column">
												<div class="form-group">
													<label for="aliquota-iss">Alíquota ISS (%):</label>
													<input type="number" id="aliquota-iss" value="5.0" min="0" max="10" step="0.01">
												</div>
											</div>
										</div>
									</div>
								</div>
								</div>
							</div>
						</div>

						<div class="group-box">
							<h3>Sistema IVA Dual e Split Payment</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="setor">Setor de Atividade:</label>
										<select id="setor" class="form-control">
											<option value="">Selecione uma atividade...</option>
											<!-- Opções preenchidas via JS -->
										</select>
									</div>
									<div class="form-group">
										<label for="aliquota-cbs">Alíquota CBS (%):</label>
										<input type="number" id="aliquota-cbs" min="0" max="100" step="0.1" readonly>
									</div>
									<div class="form-group">
										<label for="aliquota-ibs">Alíquota IBS (%):</label>
										<input type="number" id="aliquota-ibs" min="0" max="100" step="0.1" readonly>
									</div>
									<div class="form-group">
										<label for="reducao">Redução Especial (%):</label>
										<input type="number" id="reducao" min="0" max="100" step="0.1" readonly>
									</div>
									<div class="form-group">
										<label for="aliquota">Alíquota Efetiva (%):</label>
										<input type="number" id="aliquota" min="0" max="100" step="0.1" readonly>
									</div>
									<div class="form-group">
										<label for="categoria-iva">Categoria Tributária:</label>
										<select id="categoria-iva" disabled>
											<option value="standard">Padrão</option>
											<option value="reduced">Reduzida</option>
											<option value="exempt">Isenta</option>
										</select>
									</div>
								</div>
							</div>
						</div>								

						<div class="form-row">
							<div class="form-column">
								<div class="form-group">
									<label for="compensacao">Compensação de Créditos:</label>
									<select id="compensacao">
										<option value="automatica">Automática (Tempo Real)</option>
										<option value="mensal">Mensal</option>
										<option value="trimestral">Trimestral</option>
									</select>
								</div>
							</div>
						</div>		

						<div class="group-box">
							<h3>Ciclo Financeiro</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="pmr">Prazo Médio de Recebimento (dias):</label>
										<input type="number" id="pmr" value="30" min="0" step="1">
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="pmp">Prazo Médio de Pagamento (dias):</label>
										<input type="number" id="pmp" value="30" min="0" step="1">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="pme">Prazo Médio de Estoque (dias):</label>
										<input type="number" id="pme" value="30" min="0" step="1">
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="ciclo-financeiro">Ciclo Financeiro (dias):</label>
										<input type="number" id="ciclo-financeiro" value="30" readonly>
									</div>
								</div>
								<!-- Elemento modificado -->
								<div class="form-column">
									<div class="form-group checkbox-group">
										<input type="checkbox" id="considerar-split" name="considerar-split" checked>
										<label for="considerar-split">Considerar Split Payment no cálculo</label>
										<span class="tooltip">
											<i class="info-icon">i</i>
											<span class="tooltip-text">Se desabilitado, o simulador calculará o impacto da reforma tributária sem o mecanismo de Split Payment, considerando apenas a substituição dos impostos atuais pelo IVA Dual.</span>
										</span>
									</div>
								</div>
							</div>

							<!-- Campos opcionais para exibir a NCG (inicialmente ocultos) -->
							<div id="campos-ncg" style="display: none;" class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="ncg-atual">NCG Atual:</label>
										<input type="text" id="ncg-atual" readonly>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="ncg-ajustada">NCG com Split Payment:</label>
										<input type="text" id="ncg-ajustada" readonly>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="diferenca-ncg">Impacto no Capital de Giro:</label>
										<input type="text" id="diferenca-ncg" readonly class="impact-field">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="perc-vista">Percentual de Vendas à Vista (%):</label>
										<input type="number" id="perc-vista" value="30" min="0" max="100" step="1">
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="perc-prazo">Percentual de Vendas a Prazo (%):</label>
										<input type="text" id="perc-prazo" value="70%" readonly>
									</div>
								</div>
							</div>
						</div>

						<div class="group-box">
							<h3>Parâmetros da Simulação</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="data-inicial">Data Inicial:</label>
										<input type="date" id="data-inicial" value="2026-01-01">
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label for="data-final">Data Final:</label>
										<input type="date" id="data-final" value="2033-12-31">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="cenario">Cenário de Crescimento:</label>
										<select id="cenario">
											<option value="">Selecione um cenário...</option>
											<option value="conservador">Conservador (2% a.a.)</option>
											<option value="moderado">Moderado (5% a.a.)</option>
											<option value="otimista">Otimista (8% a.a.)</option>
											<option value="personalizado">Personalizado</option>
										</select>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group" id="cenario-personalizado" style="display: none;">
										<label for="taxa-crescimento">Taxa de Crescimento (% a.a.):</label>
										<input type="number" id="taxa-crescimento" value="5" min="0" max="100" step="0.1">
									</div>
								</div>
							</div>
						</div>

						<!-- Para estas duas linhas (adicionando um container para os botões) -->
						<div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
							<button id="btn-simular" style="flex: 3; padding: 15px; font-size: 16px;">Simular Impacto no Fluxo de Caixa</button>
							<button id="btn-limpar" style="flex: 1; padding: 15px; font-size: 16px;" class="btn-secondary">Limpar</button>
						</div>
					</div>
				</div>
				
				<!-- Coluna Direita - Resultados e Gráficos -->
				<div class="simulation-results">
					<!-- Painel de resultados -->
					<div class="panel">
						<h3>Resultados da Simulação</h3>
						<div id="resultados">
						
						<!-- Adicionar após <h3>Resultados da Simulação</h3> -->
						<div class="year-selector">
							<label for="ano-visualizacao">Ano de Visualização:</label>
							<select id="ano-visualizacao" onchange="atualizarResultadosPorAno()">
								<option value="2026">2026 (10%)</option>
								<option value="2027">2027 (25%)</option>
								<option value="2028">2028 (40%)</option>
								<option value="2029">2029 (55%)</option>
								<option value="2030">2030 (70%)</option>
								<option value="2031">2031 (85%)</option>
								<option value="2032">2032 (95%)</option>
								<option value="2033">2033 (100%)</option>
							</select>
						</div>
							<p class="text-muted">Preencha os dados e clique em "Simular" para visualizar os resultados.</p>

							<!-- Resultados detalhados serão carregados aqui -->
							<div id="resultados-detalhados" style="display: none;">
								<div class="result-card">
									<h4>Comparação de Sistemas Tributários</h4>
									<div class="result-grid">
										<div class="result-item">
											<span class="label">Sistema Atual:</span>
											<span id="tributo-atual" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Sistema IVA Dual:</span>
											<span id="tributo-dual" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Diferença:</span>
											<span id="tributo-diferenca" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Sistema IVA sem Split:</span>
											<span id="tributo-iva-sem-split" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Diferença IVA sem Split:</span>
											<span id="tributo-diferenca-iva-sem-split" class="value"></span>
										</div>
									</div>
								</div>
															
								<div class="result-card">
									<h4>Impacto no Capital de Giro</h4>
									<div class="result-grid">
										<div class="result-item">
											<span class="label">Regime Atual:</span>
											<span id="capital-giro-atual" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Regime IVA sem Split:</span>
											<span id="capital-giro-iva-sem-split" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Regime Split Payment:</span>
											<span id="capital-giro-split" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Impacto Total:</span>
											<span id="capital-giro-impacto" class="value impact"></span>
										</div>
										<div class="result-item">
											<span class="label">Impacto IVA sem Split:</span>
											<span id="capital-giro-impacto-iva-sem-split" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Necessidade Adicional:</span>
											<span id="capital-giro-necessidade" class="value impact"></span>
										</div>
									</div>
								</div>

								<div class="result-card">
									<h4>Impacto na Margem Operacional</h4>
									<div class="result-grid">
										<div class="result-item">
											<span class="label">Margem Atual:</span>
											<span id="margem-atual" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Margem Ajustada:</span>
											<span id="margem-ajustada" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Impacto (p.p.):</span>
											<span id="margem-impacto" class="value impact"></span>
										</div>
									</div>
								</div>
								
								<!-- Adicione este código dentro da div com id "resultados-detalhados" -->
								<div class="result-card">
									<h4>Análise de Impacto Detalhada</h4>
									<div class="result-grid">
										<div class="result-item">
											<span class="label">Percentual de Impacto:</span>
											<span id="percentual-impacto" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Impacto em Dias de Faturamento:</span>
											<span id="impacto-dias-faturamento" class="value"></span>
										</div>
									</div>
								</div>

								<div class="result-card">
									<h4>Projeção Temporal do Impacto</h4>
									<div class="result-grid">
										<div class="result-item">
											<span class="label">Necessidade Total de Capital de Giro:</span>
											<span id="total-necessidade-giro" class="value"></span>
										</div>
										<div class="result-item">
											<span class="label">Custo Financeiro Total:</span>
											<span id="custo-financeiro-total" class="value"></span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Modificar a seção de gráficos na aba de simulação -->
						<div class="group-box">
							<h3>Gráficos Comparativos</h3>
							<div class="charts-grid">
								<div class="chart-container">
									<canvas id="grafico-fluxo-caixa"></canvas>
								</div>
								<div class="chart-container">
									<canvas id="grafico-capital-giro"></canvas>
								</div>
								<div class="chart-container">
									<canvas id="grafico-projecao"></canvas>
								</div>
								<div class="chart-container">
									<canvas id="grafico-decomposicao"></canvas>
								</div>
								<div class="chart-container">
									<canvas id="grafico-sensibilidade"></canvas>
								</div>
							</div>
						</div>

						<div class="group-box">
							<h3>Exportar Resultados</h3>
							<div class="button-group">
								<button id="btn-exportar-pdf">Exportar PDF</button>
								<button id="btn-exportar-excel">Exportar Excel</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			</div>					
			
            <!-- Conteúdo da aba Configurações - manter o ID original -->
			<div id="configuracoes" class="tab-content">
				<h2>Configurações</h2>
				
				<!-- Parâmetros Gerais do Split Payment -->
				<div class="panel mb-4">
					<h3 class="panel-title">Parâmetros Gerais do Split Payment</h3>
					<p class="text-muted mb-3">Configure os valores base para o cálculo do split payment que serão aplicados a todos os setores, exceto quando houver configurações específicas.</p>

					<div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
						<div class="form-group">
							<label for="aliquota-cbs">Alíquota CBS (%):</label>
							<div class="input-group">
								<input type="number" id="aliquota-cbs" name="aliquota-cbs" min="0" max="100" step="0.01" value="8.8">
								<div class="input-group-append">
									<span class="input-group-text">%</span>
								</div>
							</div>
							<small class="help-text">Contribuição sobre Bens e Serviços - Alíquota Federal</small>
						</div>
						<div class="form-group">
							<label for="aliquota-ibs">Alíquota IBS (%):</label>
							<div class="input-group">
								<input type="number" id="aliquota-ibs" name="aliquota-ibs" min="0" max="100" step="0.01" value="17.7">
								<div class="input-group-append">
									<span class="input-group-text">%</span>
								</div>
							</div>
							<small class="help-text">Imposto sobre Bens e Serviços - Alíquota Estadual/Municipal</small>
						</div>
						<div class="form-group">
							<label for="data-inicio">Data de Início:</label>
							<input type="month" id="data-inicio" name="data-inicio" value="2026-01" min="2026-01">
							<small class="help-text">Início da implementação do split payment</small>
						</div>
					</div>
					
					<h3 class="section-subtitle mt-4">Cronograma de Implementação</h3>
					<p class="text-muted mb-3">Defina o percentual de implementação do split payment ao longo dos anos de transição (2026-2033).</p>
					
					<div class="table-actions">
						<button type="button" class="btn btn-outline" id="btn-restaurar-cronograma">Restaurar Cronograma Padrão</button>
					</div>
					
					<div class="table-container">
						<table class="editable-table cronograma-table" id="cronograma-table">
							<thead>
								<tr>
									<th>Ano</th>
									<th>Percentual (%)</th>
									<th>Observações</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>2026</td>
									<td><input type="number" name="perc-2026" min="0" max="100" step="0.1" value="10.0"></td>
									<td><input type="text" name="obs-2026" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2027</td>
									<td><input type="number" name="perc-2027" min="0" max="100" step="0.1" value="25.0"></td>
									<td><input type="text" name="obs-2027" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2028</td>
									<td><input type="number" name="perc-2028" min="0" max="100" step="0.1" value="40.0"></td>
									<td><input type="text" name="obs-2028" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2029</td>
									<td><input type="number" name="perc-2029" min="0" max="100" step="0.1" value="55.0"></td>
									<td><input type="text" name="obs-2029" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2030</td>
									<td><input type="number" name="perc-2030" min="0" max="100" step="0.1" value="70.0"></td>
									<td><input type="text" name="obs-2030" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2031</td>
									<td><input type="number" name="perc-2031" min="0" max="100" step="0.1" value="85.0"></td>
									<td><input type="text" name="obs-2031" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2032</td>
									<td><input type="number" name="perc-2032" min="0" max="100" step="0.1" value="95.0"></td>
									<td><input type="text" name="obs-2032" placeholder="Observações..."></td>
								</tr>
								<tr>
									<td>2033</td>
									<td><input type="number" name="perc-2033" min="0" max="100" step="0.1" value="100.0"></td>
									<td><input type="text" name="obs-2033" placeholder="Observações..."></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				
				<!-- Configurações Específicas por Setor -->
				<div class="panel mb-4">
					<h3 class="panel-title">Configurações Específicas por Setor</h3>
					<p class="text-muted mb-3">Configure parâmetros específicos para setores que possuem tratamento diferenciado no regime do split payment.</p>

					<div class="table-actions">
						<button type="button" class="btn btn-primary" id="btn-adicionar-setor">Adicionar Setor</button>
					</div>
				
					<div class="table-container">
						<table class="editable-table sector-table" id="sector-table">
							<thead>
								<tr>
									<th>Setor</th>
									<th>Alíquota Específica (%)</th>
									<th>Redução Especial (%)</th>
									<th>Cronograma Próprio</th>
									<th class="actions-column">Ações</th>
								</tr>
							</thead>
							<tbody>
								<tr id="setor-1">
									<td>
										<select name="setor-nome-1" class="setor-select" data-id="1">
											<option value="">Selecione um setor...</option>
											<!-- Opções de setores serão adicionadas via JavaScript -->
										</select>
									</td>
									<td><input type="number" name="setor-aliquota-1" min="0" max="100" step="0.01" value="26.5"></td>
									<td><input type="number" name="setor-reducao-1" min="0" max="100" step="0.01" value="0"></td>
									<td>
										<select name="setor-cronograma-1">
											<option value="padrao">Cronograma Padrão</option>
											<option value="proprio">Cronograma Específico</option>
										</select>
									</td>
									<td>
										<button type="button" class="btn btn-outline btn-sm" onclick="configurarCronogramaSetor(1)">Configurar</button>
										<button type="button" class="btn btn-accent btn-sm" onclick="removerSetor(1)">Remover</button>
									</td>
								</tr>
								<tr id="setor-2">
									<td>
										<select name="setor-nome-2" class="setor-select" data-id="2">
											<option value="">Selecione um setor...</option>
											<!-- Opções de setores serão adicionadas via JavaScript -->
										</select>
									</td>
									<td><input type="number" name="setor-aliquota-2" min="0" max="100" step="0.01" value="26.5"></td>
									<td><input type="number" name="setor-reducao-2" min="0" max="100" step="0.01" value="0"></td>
									<td>
										<select name="setor-cronograma-2">
											<option value="padrao">Cronograma Padrão</option>
											<option value="proprio">Cronograma Específico</option>
										</select>
									</td>
									<td>
										<button type="button" class="btn btn-outline btn-sm" onclick="configurarCronogramaSetor(2)">Configurar</button>
										<button type="button" class="btn btn-accent btn-sm" onclick="removerSetor(2)">Remover</button>
									</td>
								</tr>
								<tr id="setor-3">
									<td>
										<select name="setor-nome-3" class="setor-select" data-id="3">
											<option value="">Selecione um setor...</option>
											<!-- Opções de setores serão adicionadas via JavaScript -->
										</select>
									</td>
									<td><input type="number" name="setor-aliquota-3" min="0" max="100" step="0.01" value="26.5"></td>
									<td><input type="number" name="setor-reducao-3" min="0" max="100" step="0.01" value="0"></td>
									<td>
										<select name="setor-cronograma-3">
											<option value="padrao">Cronograma Padrão</option>
											<option value="proprio">Cronograma Específico</option>
										</select>
									</td>
									<td>
										<button type="button" class="btn btn-outline btn-sm" onclick="configurarCronogramaSetor(3)">Configurar</button>
										<button type="button" class="btn btn-accent btn-sm" onclick="removerSetor(3)">Remover</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
			
					<!-- Parâmetros Financeiros -->
					<div class="panel mb-4">
					<h3 class="panel-title">Parâmetros Financeiros</h3>
					<p class="text-muted mb-3">Configure os parâmetros financeiros para cálculo do impacto do split payment no capital de giro e fluxo de caixa.</p>
					
					<div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
						<div class="form-group">
							<label for="taxa-antecipacao">Taxa Média de Antecipação de Recebíveis:</label>
							<div class="input-group">
								<input type="number" id="taxa-antecipacao" name="taxa-antecipacao" min="0" max="100" step="0.01" value="1.8">
								<div class="input-group-append">
									<span class="input-group-text">% a.m.</span>
								</div>
							</div>
							<small class="help-text">Taxa média para antecipação de recebíveis ao mês</small>
						</div>
						
						<div class="form-group">
							<label for="taxa-capital-giro">Taxa Média de Capital de Giro:</label>
							<div class="input-group">
								<input type="number" id="taxa-capital-giro" name="taxa-capital-giro" min="0" max="100" step="0.01" value="2.1">
								<div class="input-group-append">
									<span class="input-group-text">% a.m.</span>
								</div>
							</div>
							<small class="help-text">Taxa média para linhas de capital de giro ao mês</small>
						</div>
					</div>
						
					<div class="form-group">
						<label for="spread-bancario">Spread Bancário Médio:</label>
						<div class="input-group">
							<input type="number" id="spread-bancario" name="spread-bancario" min="0" max="100" step="0.01" value="3.5">
							<div class="input-group-append">
								<span class="input-group-text">p.p.</span>
							</div>
						</div>
						<small class="help-text">Spread bancário médio em pontos percentuais</small>
					</div>					
					
					<div class="form-group mt-3">
						<label for="observacoes-financeiras">Observações Adicionais:</label>
						<textarea id="observacoes-financeiras" name="observacoes-financeiras" rows="3" placeholder="Insira aqui observações adicionais sobre os parâmetros financeiros..."></textarea>
					</div>
				
					<!-- Botões de Ação -->
					<div class="form-actions">
						<button type="button" class="btn btn-primary" id="btn-salvar-configuracoes">Salvar Configurações</button>
						<button type="button" class="btn btn-secondary" id="btn-restaurar-padroes">Restaurar Padrões</button>
					</div>
				
					<!-- Modal para Configuração de Cronograma Setorial -->
					<div class="modal-backdrop" id="modal-cronograma-setor">
						<div class="modal">
							<div class="modal-header">
								<h3 class="modal-title">Cronograma Específico para Setor</h3>
								<button type="button" class="modal-close" id="btn-fechar-modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="mb-3">
									<label for="modal-setor-nome" class="fw-bold">Setor:</label>
									<span id="modal-setor-nome"></span>
									<input type="hidden" id="modal-setor-id">
								</div>
								
								<div class="table-container">
									<table class="editable-table cronograma-table" id="cronograma-setor-table">
										<thead>
											<tr>
												<th>Ano</th>
												<th>Percentual (%)</th>
												<th>Observações</th>
											</tr>
										</thead>
										<tbody>
											<!-- Será preenchido dinamicamente por JavaScript -->
										</tbody>
									</table>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-primary" id="btn-salvar-cronograma-setor">Salvar</button>
								<button type="button" class="btn btn-secondary" id="btn-cancelar-modal">Cancelar</button>
							</div>
						</div>
					</div>
				
					</div>
				</div>
			</div>	

            <!-- Aba de Estratégias de Mitigação -->
            <div id="estrategias" class="tab-content">
                <div class="strategy-tab-container">
                    <div class="strategy-tab-buttons">
                        <button class="strategy-tab-button active" data-strategy-tab="ajuste-precos">Ajuste de Preços</button>
                        <button class="strategy-tab-button" data-strategy-tab="renegociacao-prazos">Renegociação de Prazos</button>
                        <button class="strategy-tab-button" data-strategy-tab="antecipacao-recebiveis">Antecipação de Recebíveis</button>
                        <button class="strategy-tab-button" data-strategy-tab="capital-giro">Capital de Giro</button>
                        <button class="strategy-tab-button" data-strategy-tab="mix-produtos">Mix de Produtos</button>
                        <button class="strategy-tab-button" data-strategy-tab="meios-pagamento">Meios de Pagamento</button>
                    </div>
                    
                    <!-- Ajuste de Preços -->
                    <div id="estrategia-ajuste-precos" class="strategy-tab-content active">
                        <div class="group-box">
                            <h3>Ajuste de Preços</h3>
                            <p>Compensar a perda de fluxo de caixa através de aumento em preços.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-ativar">Ativar Estratégia:</label>
                                        <select id="ap-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-percentual">Percentual de Aumento (%):</label>
                                        <input type="number" id="ap-percentual" value="5" min="0" max="100" step="0.1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-elasticidade">Elasticidade-Preço da Demanda:</label>
                                        <input type="number" id="ap-elasticidade" value="-1.2" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-impacto-vendas">Impacto nas Vendas (%):</label>
                                        <input type="number" id="ap-impacto-vendas" value="0" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-periodo">Período de Ajuste (meses):</label>
                                        <input type="number" id="ap-periodo" value="3" min="1" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Renegociação de Prazos -->
                    <div id="estrategia-renegociacao-prazos" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Renegociação de Prazos</h3>
                            <p>Negociar prazos mais longos com fornecedores para melhorar o ciclo financeiro.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-ativar">Ativar Estratégia:</label>
                                        <select id="rp-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-aumento-prazo">Aumento do Prazo (dias):</label>
                                        <input type="number" id="rp-aumento-prazo" value="15" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-percentual">Percentual de Fornecedores (%):</label>
                                        <input type="number" id="rp-percentual" value="60" min="0" max="100" step="1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-contrapartidas">Contrapartidas:</label>
                                        <select id="rp-contrapartidas">
                                            <option value="nenhuma">Nenhuma</option>
                                            <option value="volume">Aumento de Volume</option>
                                            <option value="precos">Reajuste de Preços</option>
                                            <option value="contratos">Compromisso Contratual</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-custo">Custo da Contrapartida (%):</label>
                                        <input type="number" id="rp-custo" value="0" min="0" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Antecipação de Recebíveis -->
                    <div id="estrategia-antecipacao-recebiveis" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Antecipação de Recebíveis</h3>
                            <p>Antecipar recebíveis para compensar o impacto no capital de giro.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-ativar">Ativar Estratégia:</label>
                                        <select id="ar-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-percentual">Percentual de Antecipação (%):</label>
                                        <input type="number" id="ar-percentual" value="50" min="0" max="100" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-taxa">Taxa de Desconto (% a.m.):</label>
                                        <input type="number" id="ar-taxa" value="1.8" min="0" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-prazo">Prazo Médio Antecipado (dias):</label>
                                        <input type="number" id="ar-prazo" value="25" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Capital de Giro -->
                    <div id="estrategia-capital-giro" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Capital de Giro</h3>
                            <p>Contratação de linha de capital de giro para suprir a necessidade adicional.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-ativar">Ativar Estratégia:</label>
                                        <select id="cg-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-valor">Valor de Captação (%):</label>
                                        <input type="number" id="cg-valor" value="100" min="0" max="200" step="1">
                                        <small>Percentual da necessidade adicional de capital</small>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-taxa">Taxa de Juros (% a.m.):</label>
                                        <input type="number" id="cg-taxa" value="2.1" min="0" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-prazo">Prazo de Pagamento (meses):</label>
                                        <input type="number" id="cg-prazo" value="12" min="1" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-carencia">Carência (meses):</label>
                                        <input type="number" id="cg-carencia" value="3" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mix de Produtos -->
                    <div id="estrategia-mix-produtos" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Mix de Produtos</h3>
                            <p>Ajustar mix de produtos para priorizar itens com ciclo financeiro mais favorável.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-ativar">Ativar Estratégia:</label>
                                        <select id="mp-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-percentual">Percentual de Ajuste (%):</label>
                                        <input type="number" id="mp-percentual" value="30" min="0" max="100" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-foco">Foco do Ajuste:</label>
                                        <select id="mp-foco">
                                            <option value="ciclo">Ciclo Financeiro</option>
                                            <option value="margem">Margem de Contribuição</option>
                                            <option value="vista">Vendas à Vista</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-impacto-receita">Impacto na Receita (%):</label>
                                        <input type="number" id="mp-impacto-receita" value="-5" step="0.1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-impacto-margem">Impacto na Margem (p.p.):</label>
                                        <input type="number" id="mp-impacto-margem" value="3.5" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Meios de Pagamento -->
                    <div id="estrategia-meios-pagamento" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Meios de Pagamento</h3>
                            <p>Incentivar meios de pagamento mais favoráveis ao fluxo de caixa.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-pag-ativar">Ativar Estratégia:</label>
                                        <select id="mp-pag-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Distribuição Atual:</label>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-vista-atual">À Vista (%):</label>
                                            <input type="number" id="mp-pag-vista-atual" value="30" min="0" max="100" step="1" readonly>
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-prazo-atual">A Prazo (%):</label>
                                            <input type="number" id="mp-pag-prazo-atual" value="70" min="0" max="100" step="1" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Nova Distribuição:</label>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-vista-novo">À Vista (%):</label>
                                            <input type="number" id="mp-pag-vista-novo" value="40" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-30-novo">30 dias (%):</label>
                                            <input type="number" id="mp-pag-30-novo" value="30" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-60-novo">60 dias (%):</label>
                                            <input type="number" id="mp-pag-60-novo" value="20" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-90-novo">90 dias (%):</label>
                                            <input type="number" id="mp-pag-90-novo" value="10" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-pag-taxa-incentivo">Taxa de Incentivo (%):</label>
                                        <input type="number" id="mp-pag-taxa-incentivo" value="3" min="0" step="0.1">
                                        <small>Desconto para pagamentos à vista</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="group-box">
					<h3>Resultados Estimados com Estratégias</h3>
					<div class="year-selector">
						<label for="ano-visualizacao-estrategias">Ano de Visualização:</label>
						<select id="ano-visualizacao-estrategias" onchange="atualizarVisualizacaoEstrategias()">
								<option value="2026">2026 (10%)</option>
								<option value="2027">2027 (25%)</option>
								<option value="2028">2028 (40%)</option>
								<option value="2029">2029 (55%)</option>
								<option value="2030">2030 (70%)</option>
								<option value="2031">2031 (85%)</option>
								<option value="2032">2032 (95%)</option>
								<option value="2033">2033 (100%)</option>
							<!-- Será preenchido dinamicamente pelo JavaScript -->
						</select>
					</div>
					<div id="resultados-estrategias">
						<p class="text-muted">Selecione as estratégias de mitigação e simule para ver os resultados estimados.</p>
					<!-- Dentro da div com id "resultados-estrategias", adicionar: -->
					<div class="systems-comparison">
						<h5>Comparação entre Sistemas Tributários</h5>
						<table class="comparison-table">
							<thead>
								<tr>
									<th>Sistema</th>
									<th>Capital de Giro</th>
									<th>Impostos</th>
									<th>Efetividade</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>Regime Atual</td>
									<td id="estrategia-atual-capital">R$ 0,00</td>
									<td id="estrategia-atual-impostos">R$ 0,00</td>
									<td id="estrategia-atual-efetividade">0.0%</td>
								</tr>
								<tr>
									<td>IVA sem Split</td>
									<td id="estrategia-iva-sem-split-capital">R$ 0,00</td>
									<td id="estrategia-iva-sem-split-impostos">R$ 0,00</td>
									<td id="estrategia-iva-sem-split-efetividade">0.0%</td>
								</tr>
								<tr>
									<td>IVA com Split</td>
									<td id="estrategia-iva-com-split-capital">R$ 0,00</td>
									<td id="estrategia-iva-com-split-impostos">R$ 0,00</td>
									<td id="estrategia-iva-com-split-efetividade">0.0%</td>
								</tr>
							</tbody>
						</table>
					</div>					
					</div>

					<!-- Área para dados comparativos de estratégias -->
					<div id="dados-comparativos-estrategias" style="display: none;">
						<!-- Será preenchido dinamicamente pelo JavaScript -->
					</div>
				</div>
                
                <!-- Adicionar à seção de gráficos da aba Estratégias -->
				<div class="charts-grid">
					<div class="chart-container">
						<canvas id="grafico-efetividade-estrategias"></canvas>
					</div>
					<div class="chart-container">
						<canvas id="grafico-comparacao-estrategias"></canvas>
					</div>
					<div class="chart-container">
						<canvas id="grafico-evolucao-estrategias"></canvas>
					</div>
				</div>
                
                <div class="button-group">
					<button id="btn-simular-estrategias">Simular Estratégias</button>
					<button id="btn-exportar-estrategias-pdf">Exportar PDF</button>
					<button id="btn-exportar-estrategias-excel">Exportar Excel</button>
				</div>
            </div>

            <!-- Aba de Memória de Cálculo -->
            <div id="memoria" class="tab-content">
                <div class="form-group">
                    <label for="select-ano-memoria">Selecione o ano:</label>
                    <select id="select-ano-memoria">
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                        <option value="2033">2033</option>
                    </select>
                </div>
                <button id="btn-atualizar-memoria">Atualizar Memória</button>
                <div id="memoria-calculo">
                    Realize uma simulação para gerar a memória de cálculo detalhada.
                </div>
                <div class="button-group">
                    <button id="btn-exportar-memoria">Exportar Memória de Cálculo</button>
                </div>
            </div>

            <!-- Aba de Ajuda e Documentação -->
            <div id="ajuda" class="tab-content">
                <div class="help-section">
                    <h3>O que é o Split Payment?</h3>
                    <p>O Split Payment é um mecanismo introduzido pela reforma tributária brasileira (LC 214/2025) que automatiza o recolhimento tributário no momento da transação comercial, separando o valor do tributo do preço do bem ou serviço e direcionando-o diretamente aos cofres públicos.</p>
                    <p>Este sistema altera significativamente o fluxo de caixa das empresas, pois elimina o intervalo entre o recebimento da venda e o pagamento do imposto, que tradicionalmente ocorria no mês seguinte.</p>
                </div>

                <div class="help-section">
                    <h3>Como funciona o Split Payment?</h3>
                    <p>No modelo padrão, ao realizar uma venda com split payment, o sistema divide automaticamente o valor:</p>
                    <ul>
                        <li><strong>Parte do valor</strong> é creditada diretamente ao vendedor.</li>
                        <li><strong>Parte correspondente aos impostos</strong> é direcionada automaticamente ao Comitê Gestor do IBS e à Receita Federal.</li>
                    </ul>
                    <p>Por exemplo, em uma venda de R$ 1.000 com alíquota de 26,5%, aproximadamente R$ 735,50 são creditados ao vendedor e R$ 264,50 vão direto para o fisco.</p>
                </div>

                <div class="help-section">
                    <h3>Impacto no Fluxo de Caixa</h3>
                    <p>O principal impacto do split payment é a redução do capital de giro disponível, pois o valor do tributo deixa de estar temporariamente sob controle da empresa. No regime anterior, as empresas utilizavam o montante tributário entre o recebimento da venda e o recolhimento do imposto como capital de giro.</p>
                </div>

                <div class="help-section">
                    <h3>Como usar o Simulador</h3>
                    <ol>
                        <li><strong>Aba Simulação</strong>: Preencha os dados da empresa, ciclo financeiro, parâmetros de tributação e simulação, e clique em "Simular" para visualizar o impacto no fluxo de caixa.</li>
                        <li><strong>Aba Configurações</strong>: Ajuste parâmetros financeiros e setoriais para personalizar a simulação.</li>
                        <li><strong>Aba Estratégias de Mitigação</strong>: Teste diferentes estratégias para mitigar o impacto do split payment no fluxo de caixa.</li>
                        <li><strong>Aba Memória de Cálculo</strong>: Visualize os cálculos detalhados por trás dos resultados apresentados.</li>
                    </ol>
                </div>

                <div class="help-section">
                    <h3>Implementação Progressiva</h3>
                    <p>O split payment será implementado gradualmente, começando com testes piloto em 2026 e alcançando implementação total em 2033. Durante esse período, apenas uma parcela dos tributos será recolhida via split payment, aumentando progressivamente conforme o cronograma oficial.</p>
                </div>
            </div>
			
			<!-- Aba de Importação SPED -->
			<div id="importacao-sped" class="tab-content">
				<div class="import-container">
					<div class="import-header">
						<h2>Importação de Arquivos SPED</h2>
						<p class="text-muted">Importe arquivos SPED para alimentar o simulador com dados reais da empresa.</p>
					</div>

					<div class="file-selector">
						<div class="group-box">
							<h3>Seleção de Arquivos</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label>SPED Fiscal (EFD ICMS/IPI)</label>
										<input type="file" id="sped-fiscal" accept=".txt" class="file-input" />
										<small class="text-muted">Arquivo de Escrituração Fiscal Digital ICMS/IPI</small>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label>SPED Contribuições (EFD PIS/COFINS)</label>
										<input type="file" id="sped-contribuicoes" accept=".txt" class="file-input" />
										<small class="text-muted">Arquivo de Escrituração Fiscal Digital PIS/COFINS</small>
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label>ECF (Escrituração Contábil Fiscal)</label>
										<input type="file" id="sped-ecf" accept=".txt" class="file-input" />
										<small class="text-muted">Arquivo de Escrituração Contábil Fiscal</small>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group">
										<label>ECD (Escrituração Contábil Digital)</label>
										<input type="file" id="sped-ecd" accept=".txt" class="file-input" />
										<small class="text-muted">Arquivo de Escrituração Contábil Digital</small>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="import-options">
						<div class="group-box">
							<h3>Opções de Importação</h3>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group checkbox-group">
										<input type="checkbox" id="import-empresa" checked />
										<label for="import-empresa">Dados da Empresa</label>
									</div>
									<div class="form-group checkbox-group">
										<input type="checkbox" id="import-produtos" checked />
										<label for="import-produtos">Produtos/Serviços</label>
									</div>
								</div>
								<div class="form-column">
									<div class="form-group checkbox-group">
										<input type="checkbox" id="import-impostos" checked />
										<label for="import-impostos">Impostos e Alíquotas</label>
									</div>
									<div class="form-group checkbox-group">
										<input type="checkbox" id="import-ciclo" checked />
										<label for="import-ciclo">Ciclo Financeiro</label>
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-column">
									<div class="form-group">
										<label for="periodo-referencia">Período de Referência:</label>
										<select id="periodo-referencia" class="form-control">
											<option value="">Último período disponível</option>
											<option value="ultimo-trimestre">Último trimestre</option>
											<option value="ultimo-semestre">Último semestre</option>
											<option value="ultimo-ano">Último ano fiscal</option>
										</select>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="button-group" style="margin-top: 20px;">
						<button id="btn-importar-sped" class="btn-primary">Importar Dados</button>
						<button id="btn-cancelar-importacao" class="btn-secondary">Cancelar</button>
					</div>

					<div class="import-log-container">
						<div class="group-box">
							<h3>Log de Importação</h3>
							<div id="import-log" class="log-area" style="height: 200px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
								<p class="text-muted">Selecione os arquivos SPED e clique em "Importar Dados" para iniciar o processo.</p>
							</div>
						</div>
					</div>
				</div>
			</div>
        </div>
        
        <div class="footer">
			<div class="copyright">
				&copy; 2025 Expertzy Inteligência Tributária
			</div>
			<div class="footer-contact">
				Dúvidas, erros ou sugestões? Entre em contato: <a href="mailto:contato@expertzy.com.br">contato@expertzy.com.br</a>
			</div>
		</div>
    </div>

    <!-- Modal de confirmação de exclusão -->
	<div id="modal-confirmar-exclusao" class="modal">
		<div class="modal-content" style="max-width: 400px;">
			<div class="modal-header">
				<h3>Confirmar Exclusão</h3>
				<span class="close">&times;</span>
			</div>
			<div class="modal-body">
				<p>Tem certeza que deseja excluir o setor <span id="nome-setor-exclusao"></span>?</p>
				<p>Esta ação não pode ser desfeita.</p>
			</div>
			<div class="modal-footer">
				<button id="btn-confirmar-exclusao" class="primary">Sim, Excluir</button>
				<button id="btn-cancelar-exclusao" class="secondary">Cancelar</button>
			</div>
		</div>
	</div>
	
    <!-- Modal para ajuda contextual -->
    <div id="modal-ajuda" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-ajuda-titulo">Ajuda</h3>
                <span class="close">&times;</span>
            </div>
            <div id="modal-ajuda-conteudo">
                <!-- Conteúdo dinâmico da ajuda -->
            </div>
        </div>
    </div>
    
    <!-- Importação dos scripts JavaScript -->
    
    <!-- Scripts principais -->
	<!-- Primeiro os utilitários -->
	<!-- Scripts de utilidades e exportação -->
	<script src="js/utils/formatters.js"></script>
	<script src="js/utils/validators.js"></script>
	<script src="js/utils/data-manager.js"></script>
	<script src="js/utils/export-core.js"></script>
	<script src="js/utils/document-exporters.js"></script>
	<script src="js/utils/export-tools.js"></script>
	<script src="js/utils/currency-formatter.js"></script>

	<!-- Depois os repositórios e gerenciadores de configuração -->
	<script src="js/config/setores-repository.js"></script>
	<script src="js/repository/simulador-repository.js"></script>
	<script src="js/config/configuracoes-setoriais.js"></script>
	<script src="js/config/setores-manager.js"></script>
	<script src="js/config/config-manager.js"></script>

	<!-- Depois os gerenciadores de UI -->
	<script src="js/ui/tabs-manager.js"></script>
	<script src="js/ui/forms-manager.js"></script>
	<script src="js/ui/charts-manager.js"></script>
	<script src="js/ui/modal-manager.js"></script>
	<script src="js/ui/setores-ui.js"></script>
	
	<!-- Scripts específicos do importador SPED -->
	<script src="js/importador/sped-parser.js"></script>
	<script src="js/importador/sped-extractor.js"></script>
	<script src="js/importador/importacao-controller.js"></script>

	<!-- Módulos refatorados de cálculo -->
	<script src="js/simulation/calculation-core.js"></script>
	<script src="js/simulation/current-tax-system.js"></script>
	<script src="js/simulation/iva-dual-system.js"></script>

	<!-- Depois os controladores -->
	<script src="js/ui/simulacao-controller.js"></script>
	<script src="js/ui/memoria-controller.js"></script>
	<script src="js/ui/estrategias-controller.js"></script>
	
	<!-- Módulo de simulação principal -->
	<script src="js/simulation/simulator.js"></script>
	<script src="js/simulation/strategies.js"></script>

	<!-- Por último, o script principal e integração -->
	<script src="js/integration.js"></script>
	<script src="js/main.js"></script>
	
    <!-- Script direto para atualização dos campos -->
	<script>
		
	let calculandoCreditos = false;
	let calculandoAliquota = false;
		
	// Funções para controle de exibição dos campos
	function ajustarCamposTributarios() {
		const regime = document.getElementById('regime').value;
		
		// Esconde todos os campos de impostos
		document.getElementById('campos-simples').style.display = 'none';
		document.getElementById('campos-lucro').style.display = 'none';
		
		// Exibe campos conforme o regime
		if (regime === 'simples') {
			document.getElementById('campos-simples').style.display = 'block';
		} else if (regime === 'presumido' || regime === 'real') {
			document.getElementById('campos-lucro').style.display = 'block';
			
			// Ajustar regime PIS/COFINS padrão
			const pisCofinsRegime = document.getElementById('pis-cofins-regime');
			if (pisCofinsRegime) {
				if (regime === 'presumido') {
					pisCofinsRegime.value = 'cumulativo';
				} else {
					pisCofinsRegime.value = 'nao-cumulativo';
				}
				
				// Atualizar campos de PIS/COFINS
				ajustarAliquotasPisCofins();
			}
			
			// Importante: chame ajustarCamposOperacao após mostrar campos-lucro
			ajustarCamposOperacao();
		}
		
		// Recalcular alíquota efetiva
		calcularAliquotaEfetiva();
	}

	function ajustarCamposOperacao() {
		const tipoOperacao = document.getElementById('tipo-operacao').value;
		const tipoEmpresa = document.getElementById('tipo-empresa').value; // Usar o campo correto
		
		// Obter referências aos campos de impostos
		const camposIcms = document.getElementById('campos-icms');
		const camposIpi = document.getElementById('campos-ipi');
		const camposIss = document.getElementById('campos-iss');
		
		console.log("Ajustando campos:", tipoOperacao, tipoEmpresa); // Debugging
		
		// Esconder todos os campos primeiro
		if (camposIcms) camposIcms.style.display = 'none';
		if (camposIpi) camposIpi.style.display = 'none';
		if (camposIss) camposIss.style.display = 'none';
		
		// Verificar se tanto operação quanto empresa foram selecionados
		if (!tipoOperacao || !tipoEmpresa) return;
		
		// Exibir campos baseado no tipo de empresa, independente do tipo de operação
		if (tipoEmpresa === 'servicos') {
			if (camposIss) camposIss.style.display = 'block';
		} else {
			if (camposIcms) camposIcms.style.display = 'block';
			if (camposIpi && tipoEmpresa === 'industria') {
				camposIpi.style.display = 'block';
			}
		}
		
		// Recalcular alíquota efetiva
		calcularAliquotaEfetiva();
	}

	function toggleCamposIncentivoICMS() {
		const possuiIncentivo = document.getElementById('possui-incentivo-icms').checked;
		const campoIncentivo = document.getElementById('campo-incentivo-icms');
		
		campoIncentivo.style.display = possuiIncentivo ? 'block' : 'none';
		
		// Atualizar cálculos quando o checkbox for alterado
		calcularAliquotaEfetiva();
	}

	// Função para ajustar os campos de PIS/COFINS com base no regime selecionado
	function ajustarAliquotasPisCofins() {
		const regime = document.getElementById('pis-cofins-regime').value;
		const camposCreditosPisCofins = document.getElementById('campos-pis-cofins-creditos');
		
		if (regime === 'cumulativo') {
			// No regime cumulativo, não há créditos
			document.getElementById('pis-aliquota').value = '0.65';
			document.getElementById('cofins-aliquota').value = '3.0';
			camposCreditosPisCofins.style.display = 'none';
		} else {
			// No regime não-cumulativo, exibir campos de créditos
			document.getElementById('pis-aliquota').value = '1.65';
			document.getElementById('cofins-aliquota').value = '7.6';
			camposCreditosPisCofins.style.display = 'block';
		}
		
		// Recalcular os créditos
		calcularCreditosTributarios();
	}

	// Função para calcular todos os créditos tributários
	function calcularCreditosTributarios() {
		// Evita recursão infinita
		if (calculandoAliquota) {
			return;
		}

		calculandoCreditos = true;
		
		// Obter o elemento do faturamento
		const campoFaturamento = document.getElementById('faturamento');

		// Extrair o valor numérico do faturamento
		let valorFaturamento;
		if (campoFaturamento.dataset.currencyInitialized === 'true') {
			// Assuming currencyInitialized means it's already a clean number or handled by external lib
			// For robustness with our new formatter, parse from "R$ 1.234,56" format
			valorFaturamento = parseFloat(campoFaturamento.value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
		} else {
			// Standard parsing: remove non-digits, then treat as cents value
			let faturamentoDigits = campoFaturamento.value.replace(/\D/g, '');
			valorFaturamento = parseFloat(faturamentoDigits) / 100;
		}
		if (isNaN(valorFaturamento)) valorFaturamento = 0;
		
		// Criar uma função auxiliar para formatar valores numéricos
		function formatarValorNumerico(valor) {
			return valor.toLocaleString('pt-BR', {
				style: 'currency',
				currency: 'BRL',
				minimumFractionDigits: 2,
				maximumFractionDigits: 2
			});
		}

		let creditosPisCofins = 0; // Declare here and initialize

		// Calcular créditos de PIS/COFINS
		if (document.getElementById('pis-cofins-regime').value === 'nao-cumulativo') {
			const pisCofinsBaseCalc = parseFloat(document.getElementById('pis-cofins-base-calc').value) / 100 || 0;
			const pisCofinsPercCredito = parseFloat(document.getElementById('pis-cofins-perc-credito').value) / 100 || 0;
			const aliquotaPIS = parseFloat(document.getElementById('pis-aliquota').value) / 100 || 0;
			const aliquotaCOFINS = parseFloat(document.getElementById('cofins-aliquota').value) / 100 || 0;
			
			creditosPisCofins = valorFaturamento * pisCofinsBaseCalc * (aliquotaPIS + aliquotaCOFINS) * pisCofinsPercCredito;

			// Atualizar o campo de crédito PIS/COFINS
			const campoCreditosPisCofins = document.getElementById('creditos-pis-cofins-calc');
			campoCreditosPisCofins.value = formatarValorNumerico(creditosPisCofins);
		} else {
			// creditosPisCofins remains 0
			const campoCreditosPisCofins = document.getElementById('creditos-pis-cofins-calc');
			campoCreditosPisCofins.value = formatarValorNumerico(creditosPisCofins); // or formatarValorNumerico(0)
		}

		// Calcular créditos de ICMS
		const icmsBaseCalc = parseFloat(document.getElementById('icms-base-calc').value) / 100 || 0;
		const icmsPercCredito = parseFloat(document.getElementById('icms-perc-credito').value) / 100 || 0;
		const aliquotaICMS = parseFloat(document.getElementById('aliquota-icms').value) / 100 || 0;

		const creditosICMS = valorFaturamento * icmsBaseCalc * aliquotaICMS * icmsPercCredito;
		const campoCreditosICMS = document.getElementById('creditos-icms-calc');
		campoCreditosICMS.value = formatarValorNumerico(creditosICMS);

		// Calcular créditos de IPI
		const ipiBaseCalc = parseFloat(document.getElementById('ipi-base-calc').value) / 100 || 0;
		const ipiPercCredito = parseFloat(document.getElementById('ipi-perc-credito').value) / 100 || 0;
		const aliquotaIPI = parseFloat(document.getElementById('aliquota-ipi').value) / 100 || 0;

		const creditosIPI = valorFaturamento * ipiBaseCalc * aliquotaIPI * ipiPercCredito;
		const campoCreditosIPI = document.getElementById('creditos-ipi-calc');
		campoCreditosIPI.value = formatarValorNumerico(creditosIPI);

		// Calcular total de créditos
		const creditosTotal = creditosPisCofins + creditosICMS + creditosIPI;

		// Atualizar o campo de créditos totais, se existir
		const campoCreditosTotal = document.getElementById('creditos');
		if (campoCreditosTotal) {
			campoCreditosTotal.value = formatarValorNumerico(creditosTotal);
		}

		// No final da função, onde há a chamada para calcularAliquotaEfetiva:
		if (!calculandoAliquota) {
			calcularAliquotaEfetiva();
		}

		calculandoCreditos = false;
	}
	
	// Função para calcular a alíquota efetiva com base nos campos tributários
	function calcularAliquotaEfetiva() {
		// Evita recursão infinita
		if (calculandoCreditos) {
			return;
		}

		calculandoAliquota = true;
		
		const regime = document.getElementById('regime').value;
		let aliquotaTotal = 0;
		
		// Simples Nacional
		if (regime === 'simples') {
			const aliquotaSimples = parseFloat(document.getElementById('aliquota-simples').value) || 0;
			aliquotaTotal = aliquotaSimples;
		}
		// Lucro Presumido ou Real
		else if (regime === 'presumido' || regime === 'real') {
			const pisCofinsRegime = document.getElementById('pis-cofins-regime').value;
			
			// PIS/COFINS
			if (pisCofinsRegime === 'cumulativo') {
				aliquotaTotal += 3.65; // 0.65% (PIS) + 3% (COFINS)
			} else {
				aliquotaTotal += 9.25; // 1.65% (PIS) + 7.6% (COFINS)
			}
			
			// ICMS 
			const camposIcms = document.getElementById('campos-icms');
			if (camposIcms.style.display !== 'none') {
				let aliquotaICMS = parseFloat(document.getElementById('aliquota-icms').value) || 0;
				
				// Aplicar incentivo fiscal se existir
				if (document.getElementById('possui-incentivo-icms').checked) {
					const incentivo = parseFloat(document.getElementById('incentivo-icms').value) || 0;
					aliquotaICMS = aliquotaICMS * (1 - (incentivo / 100));
				}
				
				aliquotaTotal += aliquotaICMS;
			}
			
			// IPI
			const camposIpi = document.getElementById('campos-ipi');
			if (camposIpi.style.display !== 'none') {
				const aliquotaIPI = parseFloat(document.getElementById('aliquota-ipi').value) || 0;
				aliquotaTotal += aliquotaIPI;
			}
			
			// ISS
			const camposIss = document.getElementById('campos-iss');
			if (camposIss.style.display !== 'none') {
				const aliquotaISS = parseFloat(document.getElementById('aliquota-iss').value) || 0;
				aliquotaTotal += aliquotaISS;
			}
		}
		
		// Atualizar campo de alíquota total
		document.getElementById('aliquota').value = aliquotaTotal.toFixed(1);
		
		// No final da função, onde há a chamada para calcularCreditosTributarios:
		if (!calculandoCreditos) {
			calcularCreditosTributarios();
		}

		calculandoAliquota = false;
	}

	/**
	 * Formats a numeric value (in major currency units, e.g., Reais) into a BRL currency string.
	 * Example: 1234.56 -> "R$ 1.234,56"
	 * @param {number} valorNumerico The number to format.
	 * @returns {string} Formatted currency string.
	 */
	function formatarMoedaParaExibicao(valorNumerico) {
		if (typeof valorNumerico !== 'number' || isNaN(valorNumerico)) {
			valorNumerico = 0;
		}
		return valorNumerico.toLocaleString('pt-BR', {
			style: 'currency',
			currency: 'BRL'
		});
	}

	// Configurar máscaras para campos de moeda
	document.addEventListener('DOMContentLoaded', function() {
		// Adicionar ao evento de carregamento da página
		const campoFaturamento = document.getElementById('faturamento');
		if (campoFaturamento) {
			CurrencyFormatter.aplicarFormatacaoMoeda(campoFaturamento);
		}

		const camposMoeda = document.querySelectorAll('.money-input');
		camposMoeda.forEach(function(campo) {
			campo.addEventListener('input', function(e) {
				let userInput = e.target.value;
				let digits = userInput.replace(/\D/g, ''); // Get only digits

				if (digits === "") {
					e.target.value = ""; // Keep it empty or format as "R$ 0,00" if preferred
					// If faturamento becomes empty/zero, trigger recalculation
					if (campo.id === 'faturamento') calcularCreditosTributarios();
					return;
				}

				let valorEmCentavos = parseInt(digits, 10);
				let valorEmReais = valorEmCentavos / 100;

				e.target.value = formatarMoedaParaExibicao(valorEmReais);

				// Trigger dependent calculations if this is the faturamento field
				if (campo.id === 'faturamento') {
					calcularCreditosTributarios();
				}
			});

			// Formatação inicial (revised)
            let initialValue = campo.value;
            let valReais = 0;
            let shouldFormat = false;

            if (initialValue === '0') { // Handles explicit value="0" from HTML (like faturamento)
                valReais = 0;
                shouldFormat = true;
            } else {
                let initialRawDigits = initialValue.replace(/\D/g, '');
                if (initialRawDigits !== '') { // If there are any digits
                    valReais = parseInt(initialRawDigits, 10) / 100;
                    shouldFormat = true;
                } else if (initialValue !== '') { // Non-empty, but no digits (e.g. "abc" or "R$")
                    valReais = 0; // Treat as zero
                    shouldFormat = true;
                }
                // If initialValue is '', shouldFormat remains false, field stays empty.
            }

            if (shouldFormat) {
                campo.value = formatarMoedaParaExibicao(valReais);
            }
		});
		
		// Inicializar campos conforme seleções iniciais
		ajustarCamposTributarios();
		ajustarCamposOperacao();
		
		// Configurar evento para atualização quando o setor for alterado
		document.getElementById('setor').addEventListener('change', function() {
			setorSelecionado(); // This function handles the IVA Dual field updates
		});
	});
	
	function setorSelecionado() {
		const select = document.getElementById('setor');
		if (!select) {
			console.warn("Elemento 'setor' não encontrado no DOM");
			return; // Sai da função se o elemento não existir
		}

		const codigoSetor = select.value;
		
		if (codigoSetor) {
			if (typeof SetoresRepository !== 'undefined' && SetoresRepository.obterSetor) {
				const setor = SetoresRepository.obterSetor(codigoSetor);
				if (setor) {
					// Valores básicos
					const aliquotaEfetiva = SetoresRepository.obterAliquotaEfetiva(codigoSetor);
					const reducaoEspecial = setor.reducaoEspecial || 0;
					
					// Novas variáveis específicas
					const aliquotaCbs = (setor['aliquota-cbs'] * 100).toFixed(1);
					const aliquotaIbs = (setor['aliquota-ibs'] * 100).toFixed(1);
					const categoriaIva = setor.categoriaIva || 'standard';

					// Atualização de todos os campos
					document.getElementById('aliquota').value = (aliquotaEfetiva * 100).toFixed(1);
					document.getElementById('reducao').value = (reducaoEspecial * 100).toFixed(1);
					//document.getElementById('aliquota-cbs').value = aliquotaCbs;
					//document.getElementById('aliquota-ibs').value = aliquotaIbs;
					document.getElementById('aliquota-cbs').value = parseFloat(aliquotaCbs).toFixed(1);
					document.getElementById('aliquota-ibs').value = parseFloat(aliquotaIbs).toFixed(1);
					document.getElementById('categoria-iva').value = categoriaIva;

					// Log detalhado para debug
					console.log('Dados atualizados:', {
						setor: setor.nome,
						aliquotaEfetiva: aliquotaEfetiva,
						cbs: aliquotaCbs,
						ibs: aliquotaIbs,
						categoria: categoriaIva
					});
				}
			}
		} else {
			// Reset para valores padrão
			const defaults = {
				aliquota: "26.5",
				reducao: "0.0",
				cbs: "8.8",
				ibs: "17.7",
				categoria: "standard"
			};
			
			Object.entries(defaults).forEach(([id, value]) => {
				const elemento = document.getElementById(id === 'categoria' ? 'categoria-iva' : `aliquota-${id}`);
				if (elemento) {
					elemento.value = value;
				}
			});
		}
	}

	// Adicionar evento de mudança ao select
	document.addEventListener('DOMContentLoaded', function() {
		// Configurar evento de mudança para o select de setores
		var selectSetor = document.getElementById('setor');
		if (selectSetor) {
			selectSetor.addEventListener('change', setorSelecionado);
		}
		
		// Executar uma vez para configurar os valores iniciais
		setorSelecionado();
	});
	</script>
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		// Adicionar event listeners para campos que afetam a exibição dos impostos
		const camposRelevantes = ['regime', 'tipo-empresa', 'tipo-operacao'];
		
		camposRelevantes.forEach(function(id) {
			const campo = document.getElementById(id);
			if (campo) {
				campo.addEventListener('change', function() {
					console.log(`Campo ${id} alterado para: ${this.value}`);
					
					if (id === 'regime') {
						ajustarCamposTributarios();
					} else {
						ajustarCamposOperacao();
					}
				});
			} else {
				console.warn(`Campo #${id} não encontrado`);
			}
		});
		
		// Inicializar campos
		ajustarCamposTributarios();
		
		// Financial Cycle Calculation
		function calcularCicloFinanceiro() {
			const pmr = parseInt(document.getElementById('pmr')?.value) || 0;
			const pmp = parseInt(document.getElementById('pmp')?.value) || 0;
			const pme = parseInt(document.getElementById('pme')?.value) || 0;
			
			const ciclo = pmr + pme - pmp;
			const campoCiclo = document.getElementById('ciclo-financeiro');
			if (campoCiclo) {
				campoCiclo.value = ciclo;
			}
		}
		
		['pmr', 'pmp', 'pme'].forEach(id => {
			const campo = document.getElementById(id);
			if (campo) {
				campo.addEventListener('input', calcularCicloFinanceiro);
			}
		});
		
		calcularCicloFinanceiro();
		
		// Credit Sales Percentage Update
		function atualizarPercPrazo() {
			const campoPercVista = document.getElementById('perc-vista');
			const campoPercPrazo = document.getElementById('perc-prazo');
			
			if (campoPercVista && campoPercPrazo) {
				const valorPercVista = parseFloat(campoPercVista.value) || 0;
				const valorPercPrazo = Math.max(0, Math.min(100, 100 - valorPercVista));
				
				campoPercPrazo.value = valorPercPrazo.toFixed(1) + '%';
			}
		}
		
		const campoPercVista = document.getElementById('perc-vista');
		if (campoPercVista) {
			campoPercVista.addEventListener('input', atualizarPercPrazo);
			campoPercVista.addEventListener('blur', atualizarPercPrazo);
		}
		
		atualizarPercPrazo();
		
		// Adicionar listeners para campos de créditos tributários
		const camposTributarios = [
			'faturamento',
			'pis-cofins-base-calc',
			'pis-cofins-perc-credito',
			'icms-base-calc', 
			'icms-perc-credito',
			'aliquota-icms',
			'ipi-base-calc',
			'ipi-perc-credito',
			'aliquota-ipi'
		];
		
		camposTributarios.forEach(function(id) {
			const campo = document.getElementById(id);
			if (campo) {
				campo.addEventListener('input', calcularCreditosTributarios);
				campo.addEventListener('change', calcularCreditosTributarios);
			}
		});
		
		// Configuração inicial
		ajustarAliquotasPisCofins();
		calcularCreditosTributarios();
		
		// Adicionar event listener para o tipo de empresa
		const campoTipoEmpresa = document.getElementById('tipo-empresa');
		if (campoTipoEmpresa) {
			campoTipoEmpresa.addEventListener('change', function() {
				ajustarCamposOperacao();
			});
		}
		
		// Adicionar event listener para o tipo de operação
		const campoTipoOperacao = document.getElementById('tipo-operacao');
		if (campoTipoOperacao) {
			campoTipoOperacao.addEventListener('change', function() {
				ajustarCamposOperacao();
			});
		}
		
		// Inicializar os campos
		ajustarCamposTributarios();
		ajustarCamposOperacao();
	});
	</script>
	
	<!-- Adicionar manualmente no HTML usando Inspect Element ou Console do navegador -->
	<script>
	(function() {
		// Função para verificar e criar elementos ausentes
		function verificarECriarElementos() {
			const containerGraficos = document.querySelector('.charts-grid');
			if (!containerGraficos) {
				const containerResultados = document.querySelector('.simulation-results');
				if (containerResultados) {
					const novoContainer = document.createElement('div');
					novoContainer.className = 'charts-grid';
					containerResultados.appendChild(novoContainer);
					console.log('Container de gráficos criado');
				}
				return;
			}
			
			// Transformar em grid se ainda não for
			containerGraficos.className = 'charts-grid';
			
			// Verificar elementos de gráficos
			const graficos = [
				'grafico-fluxo-caixa',
				'grafico-capital-giro',
				'grafico-projecao',
				'grafico-decomposicao',
				'grafico-sensibilidade'
			];
			
			graficos.forEach(id => {
				if (!document.getElementById(id)) {
					const container = document.createElement('div');
					container.className = 'chart-container';
					
					const canvas = document.createElement('canvas');
					canvas.id = id;
					
					container.appendChild(canvas);
					containerGraficos.appendChild(container);
					
					console.log(`Elemento criado: ${id}`);
				}
			});
		}
		
		// Adicionar CSS crítico
		function adicionarCSS() {
			const style = document.createElement('style');
			style.textContent = `
				.charts-grid {
					display: grid;
					grid-template-columns: repeat(2, 1fr);
					gap: 20px;
				}
				
				.chart-container {
					min-height: 250px;
					position: relative;
				}
				
				.result-card {
					background-color: #fff;
					padding: 15px;
					border-radius: 5px;
					box-shadow: 0 1px 3px rgba(0,0,0,0.1);
					margin-bottom: 20px;
				}
				
				.action-buttons-container {
					display: flex;
					gap: 15px;
					margin-top: 20px;
					margin-bottom: 30px;
				}
				
				.btn-primary {
					background-color: #0056b3;
					color: white;
					border: none;
					border-radius: 4px;
					padding: 10px 20px;
					cursor: pointer;
				}
				
				.btn-secondary {
					background-color: #6c757d;
					color: white;
					border: none;
					border-radius: 4px;
					padding: 10px 20px;
					cursor: pointer;
				}
				
				.alert {
					padding: 15px;
					border-radius: 4px;
					margin-bottom: 20px;
				}
				
				.alert-warning {
					background-color: #fff3cd;
					border: 1px solid #ffeeba;
					color: #856404;
				}
			`;
			document.head.appendChild(style);
		}
		
		// Executar quando o DOM estiver pronto
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', function() {
				verificarECriarElementos();
				adicionarCSS();
			});
		} else {
			verificarECriarElementos();
			adicionarCSS();
		}
	})();
		
		document.addEventListener('DOMContentLoaded', function() {
			TabsManager.inicializar();
		});
	
	// Controle do modal de aviso de cache
	document.addEventListener('DOMContentLoaded', function() {
		const cacheAlert = document.getElementById('cache-alert');
		const closeButton = document.getElementById('close-cache-alert');
		const proceedButton = document.getElementById('proceed-button');

		// Verificar se o usuário já viu o aviso na sessão atual
		const alertShown = sessionStorage.getItem('cacheAlertShown');

		if (!alertShown) {
			cacheAlert.style.display = 'flex';
		} else {
			cacheAlert.style.display = 'none';
		}

		// Função para fechar o modal
		function closeAlert() {
			cacheAlert.style.display = 'none';
			// Marcar que o usuário já viu o aviso nesta sessão
			sessionStorage.setItem('cacheAlertShown', 'true');
		}

		// Eventos para fechar o modal
		closeButton.addEventListener('click', closeAlert);
		proceedButton.addEventListener('click', closeAlert);

		// Fechar modal ao clicar fora da caixa (opcional)
		cacheAlert.addEventListener('click', function(event) {
			if (event.target === cacheAlert) {
				closeAlert();
			}
		});
	});
	</script>

</body>
</html>